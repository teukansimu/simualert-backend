import Parser from "rss-parser";

export async function fetchFromRSS(source) {
  const parser = new Parser();
  const feed = await parser.parseURL(source.url);
  const out = [];
  for (const it of feed.items || []) {
    const startIso = it.isoDate
      ? new Date(it.isoDate).toISOString()
      : it.pubDate
      ? new Date(it.pubDate).toISOString()
      : new Date().toISOString();

    out.push({
      source: source.name,
      source_id: it.guid || it.link || it.title,
      title: (it.title || "Tapahtuma").trim(),
      description: (it.contentSnippet || it.content || "").trim(),
      start: startIso,
      url: it.link || source.url,
      city: source.region || "Forssan seutu",
      created_at: new Date().toISOString(),
    });
  }
  return out;
}

